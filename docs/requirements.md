# 要件定義書

本システムは自然言語で与えられた指示を元に既存のGitリポジトリへコードを自動実装し、Pull Requestとして提案する。

## 全体要件
- フロントエンドからリポジトリ参照と指示文を受け付けるAPIを提供する。
- APIは非同期ジョブとして受理し、即時に`202 Accepted`と`jobId`を返却する。
- ジョブはキューイングされ、ワーカーコンテナが順次処理する。
- コンテナは隔離された実行環境でGitHubリポジトリをshallow+sparse cloneし、Claude Codeに最小限のコンテキストを渡して実装を行う。
- 実装後は新規ブランチを作成し、Draft Pull Requestを開く。
- ビルド・テスト・Lintが成功した場合にのみ完了とする。
- ジョブ状態やPR URL等のメタデータをDynamoDBに保存し、APIから照会できる。
- ユーザーへの通知はポーリングAPIまたは指定されたコールバックURLで行う。

## 非機能要件
- コンテナはrootlessかつ最小権限で実行し、外部ネットワークアクセスは必要最小限に制限する。
- GitHub操作はGitHub Appによる短命インストールトークンを使用し、個人アクセストークンは禁止。
- 入出力プロンプトやパッチ、ログは機微情報をマスキングした上で監査目的に保存する。
- 大規模リポジトリに対しても高速に処理できるよう、shallow clone と sparse-checkout を標準とする。

